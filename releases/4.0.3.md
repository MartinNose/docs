---
title: TiDB v4.0.3 Release Notes
category: Releases
aliases: ['/docs/dev/releases/v4.0.3/']
---

# TiDB v4.0.3 Release Notes

Release date: July 16, 2020

TiDB version: v4.0.3

## New Features

+ TiFlash

    - Implement file encryption in tiflash proxy. [#888](https://github.com/pingcap/tics/pull/888)

## Bug Fixes

+ TiDB

    - Return an error instead of an empty set for IndexHashJoin when an error happens during execution. [#18586](https://github.com/pingcap/tidb/pull/18586)
    - Fix infinite panic when GRPC transportReader is broken [#18562](https://github.com/pingcap/tidb/pull/18562)
    - Fix the issue that green GC doesn't scan locks on offline stores which may cause data incompleteness. [#18550](https://github.com/pingcap/tidb/pull/18550)
    - Ban the TiFlash engine for a not-read-only statement. [#18534](https://github.com/pingcap/tidb/pull/18534)
    - Return the actual error message when a query connection panics. [#18500](https://github.com/pingcap/tidb/pull/18500)
    - Ddl: fix admin repair table will reload fail on the other node [#18323](https://github.com/pingcap/tidb/pull/18323)
    - No release note, can use #18244's release note [#18291](https://github.com/pingcap/tidb/pull/18291)
    - [Bug-fix] Make spilling disk work well. [#18288](https://github.com/pingcap/tidb/pull/18288)
    - Fix a bug that replaces into a table with generated column fail [#17907](https://github.com/pingcap/tidb/pull/17907)

+ PD

    - Fix the issue that creating TSO stream may block for a while if the server crashes [#2648](https://github.com/pingcap/pd/pull/2648)
    - Fix the issue that `getSchedulers` may cause a data race [#2638](https://github.com/pingcap/pd/pull/2638)
    - Fix the issue that caused deadlock when deleting scheduler [#2637](https://github.com/pingcap/pd/pull/2637)
    - Fix the bug that balance-leader-scheduler won't consider placement rule when it enabled. [#2636](https://github.com/pingcap/pd/pull/2636)
    - Fixes the issue that sometimes service safepoint can't be set properly, which may make BR and dumpling fail. [#2635](https://github.com/pingcap/pd/pull/2635)
    - Fix dst store filter in hot region scheduler [#2627](https://github.com/pingcap/pd/pull/2627)
    - Fix the issue that the TSO request may take too long when PD leader switches [#2622](https://github.com/pingcap/pd/pull/2622)
    - Fix the problem of stale scheduler after leader change [#2608](https://github.com/pingcap/pd/pull/2608)
    - Fix the issue that when enable placement rules, sometimes replicas of region may not be able to adjust to the best location [#2605](https://github.com/pingcap/pd/pull/2605)
    - Fix the issue that the deploy path of the store is not updated if the deploy directory is moved [#2600](https://github.com/pingcap/pd/pull/2600)
    - Prevent store limit from changing to zero [#2588](https://github.com/pingcap/pd/pull/2588)

+ TiFlash

    - Fix the issue that TiFlash crash after renaming primary key column name. [#916](https://github.com/pingcap/tics/pull/916)
    - Fix the issue that concurrency learner read and remove region may meet deadlocks. [#872](https://github.com/pingcap/tics/pull/872)

## Improvements

+ TiDB

    - Add `tidb_log_desensitization` global variable to control whether do desensitization when log query. [#18581](https://github.com/pingcap/tidb/pull/18581)
    - Active tidb_allow_batch_cop by default. [#18552](https://github.com/pingcap/tidb/pull/18552)
    - Fix issue of query `information_schema.columns` cost too many memory when there are lots of tables in TiDB. [#18436](https://github.com/pingcap/tidb/pull/18436)

+ TiKV

    - A new configuration `backup.num-threads` is introduced to control the backup thread pool size. [#8199](https://github.com/tikv/tikv/pull/8199)
    - No release notes. [#8190](https://github.com/tikv/tikv/pull/8190)
    - Do not send store heartbeat when snapshot received [#8136](https://github.com/tikv/tikv/pull/8136)

+ PD

    - Support json formatted log [#2565](https://github.com/pingcap/pd/pull/2565)

+ TiFlash

    - Change the unit of the panels of DDL jobs in Grafana to operations per minute [#923](https://github.com/pingcap/tics/pull/923)
    - Reduce consumption of iops in raft module [#856](https://github.com/pingcap/tics/pull/856)

## Others

+ TiDB

    - Add system tables `tiflash_tables` and `tiflash_segments` [#18536](https://github.com/pingcap/tidb/pull/18536)
    - Executor: return the OOM error when indexHashJoin worker panics [#18527](https://github.com/pingcap/tidb/pull/18527)
    - Enable collect execution information by default [#18518](https://github.com/pingcap/tidb/pull/18518)
    - To speed up canceling a query [#18505](https://github.com/pingcap/tidb/pull/18505)
    - Change the default value of OOMAction to OOMActionCancel. [#18502](https://github.com/pingcap/tidb/pull/18502)
    - Add a header for tidb_decode_plan result. [#18501](https://github.com/pingcap/tidb/pull/18501)
    - Make the configuration checker compatible with older versions of the configuration [#18046](https://github.com/pingcap/tidb/pull/18046)
    - Insert negative primary key into auto_random table won't trigger rebase. [#17987](https://github.com/pingcap/tidb/pull/17987)

+ TiKV

    - Support dynamically changing the shared block cache's capacity [#8232](https://github.com/tikv/tikv/pull/8232)
    - Fix `test_security_status_service_with_cn` unit test [#8181](https://github.com/tikv/tikv/pull/8181)
    - Fix an issue that read may get stale data during merging [#8113](https://github.com/tikv/tikv/pull/8113)
    - Copr: support collation aware min/max aggregation functions [#8108](https://github.com/tikv/tikv/pull/8108)

+ Tools

    - BR

        * Improve parallel processing power when backing up a large database with many regions. [#410](https://github.com/pingcap/br/pull/410)
