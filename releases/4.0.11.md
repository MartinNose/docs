---
title: tidb v4.0.11 Release Notes
category: Releases
aliases: ['/docs/dev/releases/v4.0.11/']
---

# tidb v4.0.11 Release Notes

Release date: February 01, 2021

TiDB version: v4.0.11

## Bug Fixes

+ TiDB

    - Expression: handle duration type infer in least and greatest [#22580](https://github.com/pingcap/tidb/pull/22580)
    - Fixed LIKE expressions when a single character (`_`) wildcard follows a multiple character wildcard (`%`). [#22575](https://github.com/pingcap/tidb/pull/22575)
    - Expression: fix type infer for TiDB's builtin compare(least and greatest) [#22562](https://github.com/pingcap/tidb/pull/22562)
    - Fix a bug that makes the `like` function get the wrong result if pattern string is a Unicode string [#22529](https://github.com/pingcap/tidb/pull/22529)
    - Fix a bug that point get query does not get the snapshot data when the `@@tidb_snapshot` variable is set. [#22527](https://github.com/pingcap/tidb/pull/22527)
    - Avoid potential panic when generating hints from joins [#22518](https://github.com/pingcap/tidb/pull/22518)
    - Convert string to MySQL BIT correctly [#22420](https://github.com/pingcap/tidb/pull/22420)
    - Fix the 'index out of range ' issue when insert values to `tidb_rowid`. [#22359](https://github.com/pingcap/tidb/pull/22359)
    - Fix a bug about incorrectly reuse cached plan [#22353](https://github.com/pingcap/tidb/pull/22353)
    - Fix runtime panic in WEIGHT_STRING function when the length of binary/char is too large [#22332](https://github.com/pingcap/tidb/pull/22332)
    - Forbidden the invalid generated column with incorrect argument count. [#22174](https://github.com/pingcap/tidb/pull/22174)
    - Show process info when building plan. [#22148](https://github.com/pingcap/tidb/pull/22148)
    - Fix issue of runtime stats of index lookup reader doesn't accurate. [#22136](https://github.com/pingcap/tidb/pull/22136)
    - Add a cache for memory info when the cluster is deployed in container. [#22116](https://github.com/pingcap/tidb/pull/22116)
    - Fix issue of decode plan error cause by without escape special char. [#22022](https://github.com/pingcap/tidb/pull/22022)
    - Report error for invalid window specifications which are not used in window functions. [#21976](https://github.com/pingcap/tidb/pull/21976)
    - Throw error when prepared statement is execute, deallocate or prepare [#21972](https://github.com/pingcap/tidb/pull/21972)
    - Fix `insert ignore` into not exists partition should not report error [#21971](https://github.com/pingcap/tidb/pull/21971)
    - Unify the plan code for explain result and slow log. [#21964](https://github.com/pingcap/tidb/pull/21964)
    - Fix unknown columns in join using below agg [#21957](https://github.com/pingcap/tidb/pull/21957)
    - Fix wrong type inferring for ceiling function. [#21936](https://github.com/pingcap/tidb/pull/21936)
    - Double type column from table should ignore its decimal [#21916](https://github.com/pingcap/tidb/pull/21916)
    - Fix correlated aggregates which should be evaluated in outer query instead of in subqueries. [#21877](https://github.com/pingcap/tidb/pull/21877)
    - Report error for json object with key length >= 65536. [#21870](https://github.com/pingcap/tidb/pull/21870)
    - Fix compatibility issue with MySQL for function `dayname` [#21850](https://github.com/pingcap/tidb/pull/21850)
    - When using input types longer than blob (such as a longblob or longtext), the function `to_base64` always returned `NULL`. It now returns the correct value. [#21813](https://github.com/pingcap/tidb/pull/21813)
    - Fix the fail when we compare multi fields in the subquery [#21808](https://github.com/pingcap/tidb/pull/21808)
    - Fix compare float64 with float64 in json [#21785](https://github.com/pingcap/tidb/pull/21785)
    - Fix compare object json type [#21718](https://github.com/pingcap/tidb/pull/21718)
    - Fix the coercibility of the cast function [#21714](https://github.com/pingcap/tidb/pull/21714)
    - Fix unexpected panic when using IF function [#21711](https://github.com/pingcap/tidb/pull/21711)
    - Fix #20161, json search result null is not compatible with mysql [#21700](https://github.com/pingcap/tidb/pull/21700)
    - Check for only_full_group_by in ORDER BY and HAVING for query without group clause. [#21697](https://github.com/pingcap/tidb/pull/21697)
    - Fix the compatibility of extract day_time unit functions [#21676](https://github.com/pingcap/tidb/pull/21676)
    - Fix LEAD and LAG's default value can not adapt to field type [#21665](https://github.com/pingcap/tidb/pull/21665)
    - TiDB now checks to make sure that the `LOAD DATA` statement can only load data into base tables. [#21638](https://github.com/pingcap/tidb/pull/21638)
    - Handle invalid argument for addtime and subtime function [#21635](https://github.com/pingcap/tidb/pull/21635)
    - Use “round to nearest even” rule instead of “round half away from zero” for approximate-value numbers [#21628](https://github.com/pingcap/tidb/pull/21628)
    - The single-argument `WEEK()` call now recognize the global `@@default_week_format` even when the session one is not set explicitly. [#21623](https://github.com/pingcap/tidb/pull/21623)

+ PD

    - Fix the issue that member health metrics not correct [#3368](https://github.com/pingcap/pd/pull/3368)
    - If a tombstone store still has peers, make it cannot be removed. [#3352](https://github.com/pingcap/pd/pull/3352)

+ TiFlash

    - Fix the bug that TiFlash may crash when reading data [#1358](https://github.com/pingcap/tics/pull/1358)
    - Fix the issue that some data written after DDL operation may be lost after data compaction [#1350](https://github.com/pingcap/tics/pull/1350)

## Improvements

+ TiDB

    - Reorder inner joins simplified from outer joins [#22402](https://github.com/pingcap/tidb/pull/22402)

+ TiFlash

    - Metrics: grafana dashboards support multiple clusters [#1384](https://github.com/pingcap/tics/pull/1384)

## New Features

+ TiFlash

    - A coprocessor thread pool was added to queue coprocessor requests for execution, which can avoid OOM in some cases. Added two configs `cop_pool_size` and `batch_cop_pool_size`, default `NumOfPhysicalCores*2`. [#1312](https://github.com/pingcap/tics/pull/1312)

## Others

+ TiDB

    - Incorporate unicode_ci into constant propagation [#22614](https://github.com/pingcap/tidb/pull/22614)
    - Fix an issue that cause wrong collation and coercibility [#22602](https://github.com/pingcap/tidb/pull/22602)
    - Fix an issue that may get wrong collation result [#22599](https://github.com/pingcap/tidb/pull/22599)
    - Refine `CollationStrictness` to support incompatible strictnessship [#22582](https://github.com/pingcap/tidb/pull/22582)
    - Implement `utf8_unicode_ci` and `utf8mb4_unicode_ci` collation [#22558](https://github.com/pingcap/tidb/pull/22558)
    - Metrics: grafana dashboards support multiple clusters [#22534](https://github.com/pingcap/tidb/pull/22534)
    - Fix a bug that the `like` function returns the wrong result when using collation [#22531](https://github.com/pingcap/tidb/pull/22531)
    - TiDB 4.0.9 fixed a security issue, where TiDB incorrectly permitted multiple statements to be executed in one `COM_QUERY` packet, leading to increased risk of SQL injection. To provide backwards compatibility for applications that depend on this behavior, a new option `tidb_multi_statement_mode` has been added. Assuming you understand the security risks, you can revert to the 4.0.8 by executing `SET GLOBAL tidb_multi_statement_mode='ON'`. The default behavior of `tidb_multi_statement_mode` also relaxes the error introduced in 4.0.9 to a warning. It is intended to be changed to an error again in a future release. [#22468](https://github.com/pingcap/tidb/pull/22468)
    - Metrics slow query is divided into internal and general [#22405](https://github.com/pingcap/tidb/pull/22405)
    - Add `utf8_unicode_ci` and `utf8mb4_unicode_ci` interface. [#22099](https://github.com/pingcap/tidb/pull/22099)
    - Error message redact normalize. [#21889](https://github.com/pingcap/tidb/pull/21889)

+ TiKV

    - No release notes [#9604](https://github.com/tikv/tikv/pull/9604)
    - Server: add server info metrics for DBasS [#9591](https://github.com/tikv/tikv/pull/9591)
    - Fix unmatched memory information [#9589](https://github.com/tikv/tikv/pull/9589)
    - (I'm not sure if it's necessary) [#9583](https://github.com/tikv/tikv/pull/9583)
    - Add utf8mb4_unicode_ci implement [#9577](https://github.com/tikv/tikv/pull/9577)
    - Metrics: grafana dashboards support multiple clusters [#9572](https://github.com/tikv/tikv/pull/9572)
    - Fix the issue that when loading old value for CDC's incremental scan on a key where there's a rolled back transaction, in some cases TiKV may panic. [#9569](https://github.com/tikv/tikv/pull/9569)
    - Fix old value config glitch when changefeeds with different settings connect to one region [#9565](https://github.com/tikv/tikv/pull/9565)
    - Fixes a crash problem when running a TiKV on a machine with a network interface lacking MAC address since v4.0.9. [#9516](https://github.com/tikv/tikv/pull/9516)
    - Fix the problem that TiKV OOM when we backup a huge region. [#9448](https://github.com/tikv/tikv/pull/9448)
    - Report RocksDB metrics to TiDB [#9316](https://github.com/tikv/tikv/pull/9316)
    - Add `cast_year_as_time` [#9299](https://github.com/tikv/tikv/pull/9299)
    - Record suspend time for coprocessor task [#9277](https://github.com/tikv/tikv/pull/9277)

+ PD

    - Fix the issue that the store limit cannot be persisted [#3403](https://github.com/pingcap/pd/pull/3403)
    - Fix the limit constriction of the scatter range scheduler [#3401](https://github.com/pingcap/pd/pull/3401)
    - Metrics: grafana dashboards support multiple clusters [#3398](https://github.com/pingcap/pd/pull/3398)

+ TiFlash

    - Optimize the performance of date_format function in TiFlash [#1339](https://github.com/pingcap/tics/pull/1339)

+ Tools

    - BR

        * Fix the issue that in rawkv mode, the end key of restoring range may be included, which is expected to be exclusive. [#726](https://github.com/pingcap/br/pull/726)

    - TiCDC

        * Fix atomicity of transactions is broken in the downstream [#1375](https://github.com/pingcap/ticdc/pull/1375)
        * Fix a bug that kv client may skip to recreate event feed receiving routine by accident. [#1373](https://github.com/pingcap/ticdc/pull/1373)
        * Adjust default sort-dir and add warnings about choice of sort-dir [#1372](https://github.com/pingcap/ticdc/pull/1372)
        * Check update safepoint error. [#1367](https://github.com/pingcap/ticdc/pull/1367)
        * Fix potential data loss if a processor crashes when starting up a table. [#1363](https://github.com/pingcap/ticdc/pull/1363)
        * Fix metric `ticdc_processor_num_of_tables` and `ticdc_processor_table_resolved_ts` are properly updated when processor removes a table or the processor itself stops. [#1351](https://github.com/pingcap/ticdc/pull/1351)
        * Metrics: grafana dashboards support multiple clusters [#1350](https://github.com/pingcap/ticdc/pull/1350)
        * Fix a bug that TiCDC server could hang when processing a new changefeed with invalid sort-engine parameter [#1326](https://github.com/pingcap/ticdc/pull/1326)
        * Fix the output in changefeed out of order [#1323](https://github.com/pingcap/ticdc/pull/1323)
